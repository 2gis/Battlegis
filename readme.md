# Движок для создания танко-ботов на js

## Идеи

1. Чтоб было интересно!
2. Боты пишутся на js.
3. Боты загружаются на сервер (по команде) с лагом не более 5 секунд. То есть, разработка и сражение идут параллельно.
4. Интересное время создания бота: от 5 минут до 5 часов.
5. Должен быть тонкий клиент, который визуализирует битву.

## Запуск

1. npm install
2. node server
3. открыть в браузере client/index.html

боты лежат в папке bots

## Физика

Все размеры - условные пиксели. Это могут быть сантиметры, километры или парсеки, не важно. Но для простоты будем называть эти единицы пикселями. Главное понимать, что это не экранные, логические, физические или CSS пиксели. Это просто условные единицы длины.

У ботов есть 4 передачи. Номер передачи определяет максимальное количество пикселей за тик. Начиная с 3 передачи бота при поворотах и разворотах заносит. При использовании методов направления автоматически включается не более чем 1 передача; остальные три можно включить только через метод gear() который принимает +1 или -1 (повышение или понижение передачи).

Бот может стрелять когда его параметр armed больше 10. Он увеличивается каждый тик и может достигать максимум 30. Каждый выстрел уменьшает его на 10. То есть на старте или после долгого перерыва можно быстро сделать три выстрела, но потом скорострельност резко снижается.

Бот не может выехать за пределы карты. Его перемещение также ограничено другими ботами.

После респавна у бота есть бессмертие - параметр immortal имеющий значение 10 и уменьшающийся на 1 каждый тик. Он обнуляется мгновенно при попытке выстрелить.

## Как написать бота

Приложение зациклино через setInterval(tick, 200). Каждый тик выполняется: ai всех ботов; выполнение всех их "желаний" при возможности; пересчёт положений снарядов и ботов.

AI - это js-функция, вызванная в контексте инстанса бота. У контекста есть пять методов:

```js
// Направления (включает первую передачу если была нулевая)
this.left();
this.up();
this.right();
this.down();

// Огонь
this.fire();

// Переключение передачи (0-4)
this.gear(+1); // или -1 на понижение, или 0 на выключение

this.armed; // Параметр готовности стрельбы, 0-30. Выстрел отнимает 10.
this.immortal; // Число тиков до потери бессмертия. При попытке выстрелить бессмертие теряется мгновенно.
```

Движок запоминает только последнее направление. Огонь ведётся в направлении последнего движения.

Каждому боту известно всё о карте. Данные находятся в объекте

```js
this.frame = {
    // Живые боты на карте
    players: [{
        x: 46, // Положение бота, карта обычно размером от 0 до 100-300
        y: 84,
        width: 5, // Стандартный размер танка
        height: 5,
        health: 100, // Здоровье бота, максимум 100
        immortal: 6 // Количество тиков до потери бессмертия
    }],
    shells: [{
        id: 'tim1238908', // Уникальный идентификатор снаряда
        vector: [0, 1], Направление полёта снаряда, в данном случае вниз (Y направлен вниз)
        x: 123,
        y: 25,
        shooter: 'dima' // Имя бота, который выпустил этот снаряд
    }],
    map: {
        size: { // Размеры карты
            x: 100,
            y: 200
        }
    },
    _: lodash
}
```

Рандомный бот:
```js
var moves = ['left', 'up', 'right', 'down'];
var method = moves[Math.round(Math.random() * 4)];

method = method || 'left';
this[method]();
this.fire();
```
