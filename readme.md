# Движок для создания танков на js

## API танков

Приложение зациклино через setInterval(tick, 200). Каждый тик выполняется: ai всех ботов; пересчёт положений снарядов и ботов.

AI - это js-функция, вызванная в контексте инстанса бота. У контекста есть пять методов:

```js
// Направления
this.left();
this.up();
this.right();
this.down();
```
При вызове любого метода танк поворачивается в соответствующую сторону и проезжает в эту сторону 1 условный пиксель. Если за 1 тик вызвать несколько методов, реально вызовется только последний (в данном случае this.down). Если ни один из методов не был вызван, танк остановится в направлении предыдущего движения.
```js
// Огонь
this.fire();
```
Попытка выстрелить. Огонь ведётся только в направлении движения (башня не крутится). На старте у бота есть 3 снаряда, которые можно расстрелять за три следующих тика. Снаряды восстанавливаются по 1 штуке за 10 тиков до максимального значения в 3 снаряда.
```js
// Ускорение
this.nitro();
```
Резкое ускорение в направлении движения. На старте у бота есть 6 литров закиси азота, которые можно потратить за 6 следующих тиков. Затем закись восстанавливается по 1 литру за 10 тиков, но только после не использования метода в течение 10 тиков.
```js
// Противник
this.enemy;
```
Это поле, в котором хранится текущий преследуемый противник. Назначается автоматически. Можно задать вручную через метод
```js
// Преследование противника
this.pursue(enemyId || undefined);
```
Записывает в this.enemy случайного бота, либо переданного в первом аргументе, и начинает его преследовать. По сути, this.pursue - это автоматический вызов одного из четырёх методов передвижения для максимально быстрого выхода на одну линию с противником.
```js
// Убегание
this.escape(enemyId || undefined);
```
Автоматический вызов одного из четырёх методов передвижения для максимального удаления от текущего противника.

У танка есть набор флагов, характеризующих его состояние:
```js
this.health; // Здоровье танка, 0-100.
this.armed; // Параметр готовности стрельбы, 0-30. Выстрел отнимает 10.
this.immortal; // Число тиков до потери бессмертия. При попытке выстрелить бессмертие теряется мгновенно.
this.stamina; // Запас стамины - количество тиков, в течение которых можно использовать метод nitro. Вызов метода nitro отменяет восстановление стамины на 10 тиков.
```

Особый набор флагов находится в объекте
```js
this.powerups == {
    '2gisDamage': 25
};
```
В этом примере у танка есть '2gisDamage', который будет сохраняться следующие 25 тиков. То есть следующие 25 тиков у снарядов танка будет двойной урон.

Все данные о других танках, границах карты, летящих снарядах и поверапах находятся в объекте frame, который имеет следующую структуру:
```js
this.frame = {
    // Живые боты на карте
    players: [{
        id: 123, // Уникальный идентификатор бота
        name: 'overmind', // Никнейм бота
        x: 46, // Положение бота, карта обычно размером 100 на 120
        y: 84,
        width: 5, // Стандартный размер танка
        height: 5,
        health: 100, // Здоровье бота, максимум 100
        immortal: 6, // Количество тиков до потери бессмертия
        // Массив поверапов, в данном тике подцепленных игроком
        powerups: [{
            type: '2gisDamage',
            left: 12 // Количество тиков после которого поверап кончится
        }],
    }],
    enemy: ... // Случайный бот, являющийся текущей целью
    // Массив летящих снарядов
    shells: [{
        id: '123', // Уникальный идентификатор снаряда
        vector: [0, 1], Направление полёта снаряда, в данном случае вниз (Y направлен вниз)
        x: 123,
        y: 25,
        shooter: '123' // Идентификатор бота, который выпустил этот снаряд
    }],
    // Массив поверапов, в данном тике находящихся на карте
    powerups: [{
        type: '2gisDamage',
        left: 12
    }],
    map: {
        size: { // Размеры карты
            x: 100,
            y: 120
        }
    }
}
```

Рандомный бот:
```js
var moves = ['left', 'up', 'right', 'down'];
var method = moves[Math.foor(Math.random() * 4)];

this[method]();
this.fire();
```

## Физика

Все размеры - условные пиксели. Это могут быть сантиметры, километры или парсеки, не важно. Но для простоты будем называть эти единицы пикселями. Главное понимать, что это не экранные, логические, физические или CSS пиксели. Это просто условные единицы длины.

У ботов есть 4 передачи. Номер передачи определяет максимальное количество пикселей за тик. Начиная с 3 передачи бота при поворотах и разворотах заносит. При использовании методов направления автоматически включается не более чем 1 передача; остальные три можно включить только через метод gear() который принимает +1 или -1 (повышение или понижение передачи).

Бот может стрелять когда его параметр armed больше 10. Он увеличивается каждый тик и может достигать максимум 30. Каждый выстрел уменьшает его на 10. То есть на старте или после долгого перерыва можно быстро сделать три выстрела, но потом скорострельност резко снижается.

Бот не может выехать за пределы карты. Его перемещение также ограничено другими ботами.

После респавна у бота есть бессмертие - параметр immortal имеющий значение 10 и уменьшающийся на 1 каждый тик. Он обнуляется мгновенно при попытке выстрелить.
